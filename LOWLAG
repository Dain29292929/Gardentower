--!strict
-- Roblox Low Graphic + Screen Off Overlay (Visible at Start, Fullscreen, Materials Stripped)
local Players = game:GetService("Players")
local Lighting = game:GetService("Lighting")
local RunService = game:GetService("RunService")
local MaterialService = game:GetService("MaterialService")
local Player = Players.LocalPlayer

-- ========= GUI (?? ??, ????) =========
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "LowGraphicGui"
screenGui.IgnoreGuiInset = true           -- ? ?? ?? ? ??
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.DisplayOrder = 1_000_000        -- ? ?? UI??? ?
screenGui.Parent = Player:WaitForChild("PlayerGui")

-- ?? ?? ?? Overlay (???? ???)
local overlay = Instance.new("Frame")
overlay.Name = "FullBlackOverlay"
overlay.Size = UDim2.fromScale(1, 1)
overlay.Position = UDim2.fromScale(0, 0)
overlay.BackgroundColor3 = Color3.new(0, 0, 0)
overlay.BackgroundTransparency = 0
overlay.Visible = true                    -- ? ?? ? ??
overlay.ZIndex = 999
overlay.Parent = screenGui

-- ?? ??(??)
local btn = Instance.new("TextButton")
btn.Name = "ToggleScreen"
btn.Size = UDim2.fromOffset(320, 92)      -- ? ??
btn.Position = UDim2.fromScale(0.97, 0.92)
btn.AnchorPoint = Vector2.new(1, 1)
btn.Text = "?? ?? (ON)"
btn.TextScaled = true
btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
btn.TextColor3 = Color3.new(1, 1, 1)
btn.AutoButtonColor = true
btn.BorderSizePixel = 0
btn.ZIndex = 1000                         -- ? overlay ?
btn.Parent = screenGui
do
	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 16)
	corner.Parent = btn
	local stroke = Instance.new("UIStroke")
	stroke.Thickness = 2
	stroke.Transparency = 0.25
	stroke.Parent = btn
end

-- ?? ???? ?? ?? ??
local function toggleOverlay()
	overlay.Visible = not overlay.Visible
	btn.Text = overlay.Visible and "?? ?? (ON)" or "?? ?? (OFF)"
end
btn.MouseButton1Click:Connect(toggleOverlay)

-- ========= Low Graphics & Materials Strip =========

-- ?????? ??? & Atmosphere ??
local effectClasses = {
	["BloomEffect"] = true,
	["BlurEffect"] = true,
	["ColorCorrectionEffect"] = true,
	["DepthOfFieldEffect"] = true,
	["SunRaysEffect"] = true,
}

local function killPostEffects()
	for _, child in ipairs(Lighting:GetChildren()) do
		if effectClasses[child.ClassName] and child:IsA("PostEffect") then
			child.Enabled = false
		elseif child.ClassName == "Atmosphere" then
			local atm = child :: any
			pcall(function()
				atm.Density = 0
				atm.Haze = 0
				atm.Glare = 0
				atm.Mie = 0
				atm.Offset = 0
			end)
		end
	end
end

-- ??? ?? ??(=???) : SmoothPlastic, MaterialVariant ??, ?? 0
local function stripMaterialsInWorkspace()
	for _, obj in ipairs(workspace:GetDescendants()) do
		if obj:IsA("BasePart") then
			pcall(function()
				obj.Material = Enum.Material.SmoothPlastic
				if obj:IsA("MeshPart") then
					obj.RenderFidelity = Enum.RenderFidelity.Automatic
				end
				-- ?? ???? ???? ?? ????? ??
				if (obj :: any).MaterialVariant ~= nil then
					(obj :: any).MaterialVariant = ""
				end
				obj.Reflectance = 0
				obj.CastShadow = false
			end)
		elseif obj:IsA("Decal") or obj:IsA("Texture") then
			obj.Transparency = 1
		elseif obj:IsA("ParticleEmitter") or obj:IsA("Trail") then
			obj.Enabled = false
		end
	end
end

-- ?? ??? ???? ?? ??/?? ?? ??
workspace.DescendantAdded:Connect(function(obj)
	if obj:IsA("BasePart") then
		pcall(function()
			obj.Material = Enum.Material.SmoothPlastic
			if (obj :: any).MaterialVariant ~= nil then
				(obj :: any).MaterialVariant = ""
			end
			obj.Reflectance = 0
			obj.CastShadow = false
		end)
	elseif obj:IsA("Decal") or obj:IsA("Texture") then
		obj.Transparency = 1
	elseif obj:IsA("ParticleEmitter") or obj:IsA("Trail") then
		obj.Enabled = false
	end
end)

-- Lighting ???(???/?? ?? ?)
local function simpleLighting()
	Lighting.GlobalShadows = false
	Lighting.Brightness = 1
	Lighting.ClockTime = 13
	Lighting.EnvironmentSpecularScale = 0
	Lighting.EnvironmentDiffuseScale = 0
	-- ??? ???? ??(??? ? ?? ????? ??)
end

-- Terrain ???
local function simpleTerrain()
	local terrain = workspace:FindFirstChildOfClass("Terrain")
	if not terrain then return end
	pcall(function()
		terrain.WaterWaveSize = 0
		terrain.WaterWaveSpeed = 0
		terrain.WaterTransparency = 1
		terrain.WaterReflectance = 0
		terrain.Decoration = false
	end)
end

-- 2022 ???? ???(??? ?????)
pcall(function()
	if MaterialService then
		MaterialService.Use2022Materials = false
	end
end)

-- ========= Anti-aging (??? ?? ???) =========
local CULL_RADIUS = 300    -- ? ?? ? ??? ? ???
local UPDATE_INTERVAL = 0.2 -- ?? ??: 0.2??? ??

local elapsed = 0
RunService.Heartbeat:Connect(function(dt)
	elapsed += dt
	if elapsed < UPDATE_INTERVAL then return end
	elapsed = 0

	local char = Player.Character
	if not char then return end
	local hrp = char:FindFirstChild("HumanoidRootPart") :: any
	if not hrp then return end
	local rootPos = (hrp :: any).Position

	for _, obj in ipairs(workspace:GetDescendants()) do
		if obj:IsA("BasePart") then
			-- ?? ??? ??? ??
			if not obj:IsDescendantOf(char) then
				local dist = (obj.Position - rootPos).Magnitude
				if dist > CULL_RADIUS then
					obj.LocalTransparencyModifier = 1    -- ??? ??
				else
					obj.LocalTransparencyModifier = 0
				end
			end
		end
	end
end)

-- ========= (??) Streaming ?? ??: ??? StreamingEnabled? ?? ?? =========
pcall(function()
	local ws = workspace
	if (ws :: any).StreamingEnabled then
		(ws :: any).StreamingTargetRadius = 160
		(ws :: any).StreamingMinRadius = 64
	end
end)

-- ========= ?? ?? =========
simpleLighting()
simpleTerrain()
killPostEffects()
stripMaterialsInWorkspace()

-- ???(F8)?? ?? ?? ??
game:GetService("UserInputService").InputBegan:Connect(function(input, gp)
	if gp then return end
	if input.KeyCode == Enum.KeyCode.F8 then
		toggleOverlay()
	end
end)
